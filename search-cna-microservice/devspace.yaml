version: v2beta1
name: search

imports:
  - path: "../.devpilot-scripts/devspace-pipelines.yaml"

vars:
  SERVICE_NAME:
    default: "search"
  K8S_MANIFEST_PATH_LOCAL:
    default: "${K8S_DIR}/infra/k8s/apps/overlays/local/search/"
  K8S_MANIFEST_PATH_AZURE:
    default: "${K8S_DIR}/infra/k8s/apps/overlays/azure/search/"

dev:
  search:
    labelSelector:
      app: search-deployment
    container: search
    devImage: ghcr.io/loft-sh/devspace-containers/javascript:18-alpine
    sync:
      - path: ./:/app
        excludePaths:
          - .devspace/
          - node_modules/
          - .git/
          - "*.log"
        initialSync: preferLocal
        printLogs: true
    terminal:
      command: ./devspace_start.sh
    ports:
      - port: "4000"
    env:
      - name: NODE_ENV
        value: "development"
      - name: ELASTIC_URL
        value: "http://localhost:9200/"
  # Remote Debug configuration for the search service
  search-debug:
    labelSelector:
      app: search-deployment
    container: search
    command:
      - node
      - --inspect=0.0.0.0:9230
      - server.js
    ports:
      - port: "9230:9230"
