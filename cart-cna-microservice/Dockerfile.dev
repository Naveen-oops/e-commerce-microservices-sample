FROM ghcr.io/loft-sh/devspace-containers/java-gradle:7-jdk17-slim

WORKDIR /app

# Copy gradle files first for better caching
COPY build.gradle settings.gradle gradlew ./
COPY gradle/ gradle/

# Download dependencies
RUN gradle dependencies --no-daemon

# Copy source code
COPY . .

# Build the application
RUN gradle clean build -x test --no-daemon

# Copy the startup script and make it executable
RUN chmod +x devspace_start.sh